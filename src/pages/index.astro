---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import FormattedDate from '../components/FormattedDate.astro';
import { Image } from 'astro:assets';

const allPosts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const featurePost = allPosts[0];
const sidePosts = allPosts.slice(1, 4);
const latestArticles = allPosts.slice(0, 6);
const financialEvents = allPosts
	.filter((post) => post.data.category === 'events')
	.slice(0, 6);
---

<Layout>
	<div class="verge-wrapper container">
		<section class="hero-grid">
			<div class="feature-story">
				<a href={`/blog/${featurePost.id}/`} class="feature-link">
					<div class="feature-image">
						{featurePost.data.heroImage && <Image width={1200} height={800} src={featurePost.data.heroImage} alt="" />}
					</div>
					<div class="feature-content">
						<div class="category-badge">{featurePost.data.category ? featurePost.data.category.replace('-', ' ') : 'Feature'}</div>
						<h1 class="feature-title">{featurePost.data.title}</h1>
						<p class="feature-excerpt">{featurePost.data.description}</p>
						<div class="meta">
							<span class="author">By {featurePost.data.author || 'MoneyJuan Team'}</span>
							<span class="separator">•</span>
							<FormattedDate date={featurePost.data.pubDate} />
						</div>
					</div>
				</a>
			</div>

			<div class="side-stories">
				<h2 class="side-heading">Top Stories</h2>
				<div class="side-list">
					{sidePosts.map((post) => (
						<a href={`/blog/${post.id}/`} class="side-item">
							<div class="side-content">
								<div class="category-small">{post.data.category ? post.data.category.replace('-', ' ') : 'Article'}</div>
								<h3 class="side-title">{post.data.title}</h3>
								<div class="meta-small">
									<span class="author-small">By {post.data.author || 'MoneyJuan Team'}</span>
									<span class="separator-small">•</span>
									<FormattedDate date={post.data.pubDate} />
								</div>
							</div>
							<div class="side-image">
								{post.data.heroImage && <Image width={640} height={360} src={post.data.heroImage} alt="" />}
							</div>
						</a>
					))}
				</div>
			</div>
		</section>

		<hr class="section-divider" />

		{latestArticles.length > 0 && (
			<section class="articles-section">
				<h2 class="section-title">Latest Articles</h2>
				<div class="articles-grid">
					{latestArticles.map((post) => (
						<a href={`/blog/${post.id}/`} class="article-card">
							<div class="article-image">
								{post.data.heroImage && <Image width={400} height={250} src={post.data.heroImage} alt="" />}
							</div>
							<div class="article-content">
								<div class="category-small">{post.data.category ? post.data.category.replace('-', ' ') : 'Article'}</div>
								<h3 class="article-title">{post.data.title}</h3>
								<div class="meta-small">
									<span class="author-small">By {post.data.author || 'MoneyJuan Team'}</span>
									<span class="separator-small">•</span>
									<FormattedDate date={post.data.pubDate} />
								</div>
							</div>
						</a>
					))}
				</div>
			</section>
		)}

		<hr class="section-divider" />

		{financialEvents.length > 0 && (
			<section class="events-section">
				<h2 class="section-title">Latest Financial Events</h2>
				<div class="articles-grid">
					{financialEvents.map((post) => (
						<a href={`/blog/${post.id}/`} class="article-card">
							<div class="article-image">
								{post.data.heroImage && <Image width={400} height={250} src={post.data.heroImage} alt="" />}
							</div>
							<div class="article-content">
								<div class="category-small">{post.data.category ? post.data.category.replace('-', ' ') : 'Event'}</div>
								<h3 class="article-title">{post.data.title}</h3>
								<div class="meta-small">
									<span class="author-small">By {post.data.author || 'MoneyJuan Team'}</span>
									<span class="separator-small">•</span>
									<FormattedDate date={post.data.pubDate} />
								</div>
							</div>
						</a>
					))}
				</div>
			</section>
		)}

		<section class="newsletter-cta">
			<div class="newsletter-content">
				<div class="newsletter-text">
					<h2 class="newsletter-title">Wealth in your inbox.</h2>
					<p class="newsletter-desc">Join Filipinos getting practical money tips every week. No fluff, just actionable advice to grow your net worth.</p>
					<div class="newsletter-features">
						<div class="feature-item">
							<span class="check-icon">✓</span> Free Guides
						</div>
						<div class="feature-item">
							<span class="check-icon">✓</span> Market Updates
						</div>
						<div class="feature-item">
							<span class="check-icon">✓</span> Exclusive Deals
						</div>
					</div>
				</div>
				<div class="newsletter-form-container">
					<form class="cta-form">
						<input type="email" placeholder="Coming soon" class="cta-input" disabled readonly />
						<button type="button" class="cta-btn" disabled>Coming Soon</button>
					</form>
					<p class="cta-subtext">Newsletter signups are coming soon.</p>
				</div>
			</div>
		</section>

	</div>
</Layout>

<style>
	.verge-wrapper {
		padding-top: var(--space-md);
		padding-bottom: var(--space-lg);
	}

	.hero-grid {
		display: grid;
		grid-template-columns: 1.45fr 1fr;
		gap: var(--space-md);
		margin-bottom: var(--space-lg);
	}

	.feature-story {
		position: relative;
	}

	.feature-link {
		text-decoration: none;
		color: inherit;
		display: block;
		height: 100%;
	}

	.feature-image {
		width: 100%;
		aspect-ratio: 16/8;
		max-height: clamp(230px, 32vw, 360px);
		overflow: hidden;
		border-radius: 12px;
		margin-bottom: var(--space-sm);
		box-shadow: var(--shadow-md);
		border: 1px solid var(--color-border);
	}

	.feature-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.5s var(--ease-out-expo);
	}

	.feature-content {
		padding-right: var(--space-md);
	}

	.category-badge {
		font-family: var(--font-display);
		font-weight: 800;
		text-transform: uppercase;
		color: var(--color-primary);
		font-size: 0.9rem;
		margin-bottom: var(--space-xs);
		letter-spacing: 0.05em;
	}

	.feature-title {
		font-family: var(--font-display);
		font-size: clamp(1.65rem, 3vw, 2.75rem);
		line-height: 1.2;
		margin-bottom: var(--space-xs);
		padding-bottom: 0.1em;
		font-weight: 800;
		letter-spacing: -0.02em;
		background: linear-gradient(to right, var(--color-text-main), var(--color-text-muted));
		-webkit-background-clip: text;
		-webkit-text-fill-color: transparent;
		background-clip: text;
	}

	.feature-excerpt {
		font-size: 1.2rem;
		color: var(--color-text-muted);
		margin-bottom: var(--space-sm);
		line-height: 1.6;
		max-width: 60ch;
	}

	.meta {
		font-size: 0.9rem;
		color: var(--color-text-muted);
		font-weight: 600;
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 0.5rem;
	}

	.separator {
		color: var(--color-border);
	}

	.side-stories {
		padding-left: var(--space-md);
		border-left: 1px solid var(--color-border);
		display: flex;
		flex-direction: column;
	}

	.side-heading {
		font-family: var(--font-display);
		font-size: 1.2rem;
		text-transform: uppercase;
		letter-spacing: 0.1em;
		color: var(--color-primary);
		margin-bottom: var(--space-md);
		padding-bottom: var(--space-xs);
		border-bottom: 2px solid var(--color-primary);
		display: inline-block;
		align-self: flex-start;
	}

	.side-list {
		display: flex;
		flex-direction: column;
		gap: var(--space-md);
	}

	.side-item {
		display: flex;
		justify-content: space-between;
		gap: var(--space-sm);
		align-items: flex-start;
		text-decoration: none;
		color: inherit;
		group: side-item;
	}

	.side-content {
		flex: 1;
	}

	.category-small {
		font-size: 0.75rem;
		font-weight: 700;
		text-transform: uppercase;
		color: var(--color-primary);
		margin-bottom: 0.25rem;
		letter-spacing: 0.05em;
	}

	.side-title {
		font-family: var(--font-display);
		font-size: 1.2rem;
		line-height: 1.3;
		font-weight: 700;
		margin-bottom: 0.5rem;
		transition: color 0.2s ease;
		color: var(--color-text-main);
	}

	.side-item:hover .side-title {
		color: var(--color-primary);
	}

	.meta-small {
		font-size: 0.8rem;
		color: var(--color-text-muted);
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 0.4rem;
		margin-top: 0.5rem;
	}

	.author-small {
		font-weight: 700;
		color: var(--color-text-main);
	}

	.separator-small {
		color: var(--color-border);
	}

	.side-image {
		width: 100px;
		height: 100px;
		flex-shrink: 0;
		border-radius: 12px;
		overflow: hidden;
		border: 1px solid var(--color-border);
	}

	.side-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	.section-divider {
		border: 0;
		border-top: 1px solid var(--color-border);
		margin: var(--space-lg) 0;
	}

	.articles-section,
	.events-section {
		margin: var(--space-lg) 0;
	}

	.section-title {
		font-family: var(--font-display);
		font-size: 2rem;
		font-weight: 800;
		color: var(--color-text-main);
		margin-bottom: var(--space-md);
		text-transform: uppercase;
		letter-spacing: 0.05em;
		border-left: 4px solid var(--color-primary);
		padding-left: var(--space-sm);
	}

	.articles-grid {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: var(--space-md);
	}

	.article-card {
		text-decoration: none;
		color: inherit;
		display: flex;
		flex-direction: column;
		background: #FFFFFF;
		border: 1px solid var(--color-border);
		border-radius: 12px;
		overflow: hidden;
		transition: all 0.3s ease;
	}

	.article-card:hover {
		box-shadow: var(--shadow-md);
		border-color: var(--color-primary);
	}

	.article-image {
		width: 100%;
		aspect-ratio: 16/9;
		overflow: hidden;
		background: var(--color-surface);
		border-bottom: 1px solid var(--color-border);
	}

	.article-card:hover .article-image {
		border-bottom-color: var(--color-primary);
	}

	.article-image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		transition: transform 0.3s ease;
	}

	.article-content {
		padding: var(--space-md);
		flex: 1;
		display: flex;
		flex-direction: column;
	}

	.article-title {
		font-family: var(--font-display);
		font-size: 1.25rem;
		font-weight: 700;
		line-height: 1.4;
		margin-bottom: var(--space-xs);
		padding-bottom: 0.1em;
		color: var(--color-text-main);
		transition: color 0.2s ease;
	}
	
	.article-card:hover .article-title {
		color: var(--color-primary);
	}
	.newsletter-cta {
		margin-top: var(--space-xl);
		margin-bottom: 0;
		background: var(--color-primary);
		border-radius: 24px;
		padding: var(--space-lg);
		color: #FFFFFF;
		position: relative;
		overflow: hidden;
	}

	.newsletter-content {
		display: grid;
		grid-template-columns: 1.2fr 1fr;
		gap: var(--space-lg);
		align-items: center;
		position: relative;
		z-index: 1;
	}

	.newsletter-title {
		font-family: var(--font-display);
		font-size: clamp(2.5rem, 5vw, 3.5rem);
		font-weight: 800;
		line-height: 1.1;
		margin-bottom: var(--space-sm);
		color: #FFFFFF;
	}

	.newsletter-desc {
		font-size: 1.2rem;
		color: #D1FAE5;
		margin-bottom: var(--space-md);
		max-width: 45ch;
	}

	.newsletter-features {
		display: flex;
		gap: var(--space-md);
		flex-wrap: wrap;
	}

	.feature-item {
		display: flex;
		align-items: center;
		gap: 0.5rem;
		font-weight: 700;
		color: #FFFFFF;
	}

	.check-icon {
		background: #FFFFFF;
		color: var(--color-primary);
		width: 24px;
		height: 24px;
		border-radius: 50%;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 0.8rem;
		font-weight: 900;
	}

	.newsletter-form-container {
		background: #FFFFFF;
		padding: var(--space-md);
		border-radius: 16px;
		box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
	}

	.cta-form {
		display: flex;
		flex-direction: column;
		gap: var(--space-sm);
	}

	.cta-input {
		padding: 1rem;
		border: 2px solid var(--color-border);
		border-radius: 8px;
		font-size: 1rem;
		font-family: var(--font-body);
		transition: border-color 0.2s ease;
	}

	.cta-input:focus {
		outline: none;
		border-color: var(--color-primary);
	}

	.cta-btn {
		background: var(--color-text-main);
		color: #FFFFFF;
		border: none;
		padding: 1rem;
		font-size: 1.1rem;
		font-weight: 700;
		border-radius: 8px;
		cursor: pointer;
		transition: transform 0.2s ease, background 0.2s ease;
	}

	.cta-btn:hover {
		transform: translateY(-2px);
		background: #000000;
	}

	.cta-input:disabled {
		background: #F3F4F6;
		color: #6B7280;
		cursor: not-allowed;
	}

	.cta-btn:disabled {
		background: #6B7280;
		cursor: not-allowed;
		transform: none;
	}

	.cta-btn:disabled:hover {
		transform: none;
		background: #6B7280;
	}

	.cta-subtext {
		text-align: center;
		font-size: 0.85rem;
		color: var(--color-text-muted);
		margin-top: var(--space-sm);
	}

	@media (max-width: 900px) {
		.hero-grid {
			grid-template-columns: 1fr;
			gap: var(--space-lg);
		}

		.newsletter-content {
			grid-template-columns: 1fr;
			text-align: center;
		}

		.newsletter-desc {
			margin-left: auto;
			margin-right: auto;
		}

		.newsletter-features {
			justify-content: center;
		}
		
		.side-stories {
			padding-left: 0;
			border-left: none;
			border-top: 1px solid var(--color-border);
			padding-top: var(--space-md);
		}

		.feature-content {
			padding-right: 0;
		}

		.articles-grid {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	@media (max-width: 600px) {
		.verge-wrapper {
			padding-top: var(--space-sm);
		}

		.feature-story::before {
			content: "Featured Article";
			font-family: var(--font-display);
			font-size: 1rem;
			text-transform: uppercase;
			letter-spacing: 0.1em;
			color: var(--color-primary);
			margin-bottom: var(--space-sm);
			padding-bottom: var(--space-xs);
			border-bottom: 2px solid var(--color-primary);
			display: inline-block;
		}

		.feature-title {
			font-size: clamp(1.4rem, 7.2vw, 1.95rem);
		}

		.feature-excerpt {
			font-size: 1rem;
		}

		.section-title {
			font-size: 1.4rem;
		}

		.newsletter-cta {
			border-radius: 16px;
			padding: var(--space-md);
		}

		.newsletter-title {
			font-size: clamp(1.9rem, 10vw, 2.4rem);
		}

		.newsletter-desc {
			font-size: 1rem;
		}

		.feature-item {
			font-size: 0.95rem;
		}

		.articles-grid {
			grid-template-columns: 1fr;
		}
	}

	@media (max-width: 480px) {
		.side-item {
			flex-direction: column-reverse;
		}

		.side-image {
			width: 100%;
			height: auto;
			aspect-ratio: 16 / 9;
		}

		.side-title {
			font-size: 1.05rem;
		}
	}
</style>
